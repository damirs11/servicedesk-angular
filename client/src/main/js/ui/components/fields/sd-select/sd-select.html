<div data-ng-show="ctrl.isViewMode">
    <span data-ng-hide="ctrl.isEditable">{{ctrl.currentDisplay}}</span>
    <a data-ng-show="ctrl.isEditable" href="javascript:void(0)" data-ng-click="ctrl.edit()">{{ctrl.currentDisplay}}</a>
</div>

<form novalidate name="$parent.ctrl.formEdit" data-ng-if="ctrl.isEditMode"
     data-sd-on-interact-out="ctrl.log()" ng-submit="ctrl.commit()">

    <div class="form-group input-group" ng-class="{ 'has-error': ctrl.formEdit.input.$invalid }">
        <div class="btn-group">
            <button type="submit"
                    class="btn btn-default dropdown-toggle"
                    data-ng-hide="ctrl.isErrorMode"
                    data-ng-disabled="ctrl.isLoadingMode"
                    sd-focus="ctrl.isEditable"
                    onkeydown="
                        console.log('KEYDOWN');
                        if (event.keyCode==40) {
                            $(this).parent().next().children().first().find('a').focus();
                            return false;
                        } else if (event.keyCode==38) {
                            $(this).parent().next().children().last().find('a').focus();
                            return false;
                    }">
                <span ng-bind="ctrl.currentDisplay"></span> <span class="caret"></span>
            </button>

            <ul class="dropdown-menu dropdown-menu-left" role="menu">
                <li ng-show="ctrl.isAllowEmpty">
                    <a href="javascript:void(0)" ng-click="ctrl.select(null);ctrl.save(null)" ng-bind="ctrl.emptyValue" sd-focus="ctrl.isEditMode && this.selectedValue == null"></a>
                </li>
                <li ng-repeat="el in ctrl.values">
                    <a href="javascript:void(0)" ng-click="ctrl.select(el);$save(el)">
                        <span ng-bind="ctrl.display(el)"></span>
                    </a>
                </li>
            </ul>



        </div>
    </div>
</form>